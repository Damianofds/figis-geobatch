<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:jms="http://servicemix.apache.org/jms/1.0"
       xmlns:ie="http://www.geo-solutions.it/GeomCompare/"
       xmlns:amq="http://activemq.org/config/1.0"
       xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://servicemix.apache.org/jms/1.0 http://servicemix.apache.org/schema/servicemix-jms-2009.01.xsd
       http://activemq.org/config/1.0 http://activemq.apache.org/schema/core/activemq-core-4.1.1.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<classpath>
    	<location>.</location>
    	<location>lib/jencks-amqpool-2.2.jar</location>
  	</classpath>
  
    <jms:endpoint id="jmsProviderEndpoint"
    			  service="ie:GeomCompareJMSProviderService"
                  endpoint="endpointE"
                  role="provider" 
                  destinationStyle="queue"
                  jmsProviderDestinationName="queue/A"
                  connectionFactory="#connectionFactory" 
                  needJavaIdentifiers="true"
                  marshaler="#producerMarshaler" />

	<jms:endpoint service="ie:GeomCompareJMSConsumerService"
                  endpoint="endpointF"
                  targetService="ie:iestatsbean" 
                  role="consumer" 
                  destinationStyle="queue"
                  jmsProviderDestinationName="queue/A"
                  defaultMep="http://www.w3.org/2004/08/wsdl/in-out" 
                  defaultOperation="ie:http"
                  connectionFactory="#connectionFactory" />

	<bean id="producerMarshaler" class="it.geosolutions.ie.jms.CustomJMSMarshaler">
		<constructor-arg><ref local="jmsProviderEndpoint"/></constructor-arg>
		<property name="jmsProperties">
			<map>
				<entry key="service">
					<value>rebuildAll</value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="connectionFactory" class="org.jencks.amqpool.PooledConnectionFactory">
		<constructor-arg value="vm://localhost" />
		<property name="maxConnections" value="8" />
		<property name="maximumActive" value="1" />
	</bean>

	<!-- bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    	<property name="brokerURL" value="vm://localhost" />
	</bean -->

	<!-- bean id="connectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory">
    	<property name="connectionFactory">
      		<bean class="org.apache.activemq.ActiveMQConnectionFactory">
        		<property name="brokerURL" value="vm://localhost" />
      		</bean>
    	</property>
    	<property name="maxConnections" value="1" />
    	<property name="maximumActive" value="1" />
	</bean -->
	
</beans>