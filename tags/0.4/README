===========================
Intersections Engine README
===========================

Compiling
=========

.. code-block:: bash
    
    mvn clean install


Running the project
===================
Oracle
------

CREATE TABLE "FIGIS_GIS"."STATISTICAL_TABLE" 
(
	"ID" NUMBER PRIMARY KEY, 
	"STATS_FID" VARCHAR2(100 BYTE),
	"SRC_NAME" VARCHAR2(100 BYTE), 
	"SRC_CODE" VARCHAR2(100 BYTE), 
	"TOT_AREA_SRC" NUMBER, 
	"TRG_NAME" VARCHAR2(100 BYTE), 
	"TRG_CODE" VARCHAR2(100 BYTE), 
	"TOT_AREA_TRG" NUMBER, 
	"AREA" NUMBER, 
	"OV_SRC" NUMBER, 
	"OV_TRG" NUMBER
); 
 
CREATE TABLE "FIGIS_GIS"."SPATIAL_TABLE" 
(	
	"ID" NUMBER PRIMARY KEY, 
	"THE_GEOM" "MDSYS"."SDO_GEOMETRY" , 
	"STATS_FID" VARCHAR2(100 BYTE)
);

INSERT INTO USER_SDO_GEOM_METADATA VALUES (
	'SPATIAL_TABLE',
	'THE_GEOM',
	MDSYS.SDO_DIM_ARRAY(
		MDSYS.SDO_DIM_ELEMENT('X',-180,180,0.005),
		MDSYS.SDO_DIM_ELEMENT('Y',-90,90,0.005)
	),
	4326
);

CREATE INDEX "FIGIS_GIS"."SPATIAL_TABLE_IDX" ON "FIGIS_GIS"."SPATIAL_TABLE" ("THE_GEOM") INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" ;

CREATE OR REPLACE FORCE VIEW "FIGIS_GIS"."SPATIAL_STATISTICAL" ("ID", "SRC_NAME", "SRC_CODE", "TOT_AREA_SRC", "TRG_NAME", "TRG_CODE", "TOT_AREA_TRG", "AREA", "OV_SRC", "OV_TRG", "THE_GEOM") AS 
  select ST.ID, ST.SRC_NAME, ST.SRC_CODE, ST.TOT_AREA_SRC, ST.TRG_NAME,
     ST.TRG_CODE, ST.TOT_AREA_TRG, ST.AREA, ST.OV_SRC, ST.OV_TRG, SP.THE_GEOM
   from STATISTICAL_TABLE ST, SPATIAL_TABLE SP
   where ST.STATS_FID = SP.STATS_FID with check option;

INSERT INTO USER_SDO_GEOM_METADATA VALUES (
	'SPATIAL_STATISTICAL',
	'THE_GEOM',
	MDSYS.SDO_DIM_ARRAY(
		MDSYS.SDO_DIM_ELEMENT('X',-180,180,0.005),
		MDSYS.SDO_DIM_ELEMENT('Y',-90,90,0.005)
	),
	4326
);

Geoserver
---------
Start Geoserver 1.7.6 with the ``figis:statistical`` and ``figis:spatial``
layers configured, expected path is http://localhost:8080/geoserver

Service Mix
-----------
Run ServiceMix and deploy the jbi.

.. code-block:: bash

    cd ie-jbi
    mvn jbi:projectDeploy

.. note::

    This only works when using the ServiceMix binary, in http://localhost:8192
    for Tomcat a manual installation will be required

Web Interface
-------------

.. code-block:: bash

    cd ie-web
    mvn  -Djetty.port=8888 clean jetty:run

Navigate to http://localhost:8888/IE-web and start using the app 
